<!doctype html>
<html lang="hu">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Bont√°sinapl√≥ ‚Äì Haszn√°lati √∫tmutat√≥</title>
<style>
@media print {
  @page { size: A4; margin: 16mm; }
  a[href]:after { content: ""; } /* hide link urls */
}

:root{
  --fg: #0f172a;
  --muted: #475569;
  --accent: #2563eb;
  --accent-2: #0ea5e9;
  --bg: #ffffff;
  --code-bg: #0b1020;
  --code-fg: #f8fafc;
}

* { box-sizing: border-box; }
html, body { padding:0; margin:0; background: var(--bg); color: var(--fg); }
.container { max-width: 920px; margin: 0 auto; padding: 28px; }

.cover {
  background: linear-gradient(135deg, var(--accent), var(--accent-2));
  color: white;
  padding: 64px 28px;
  border-bottom: 6px solid rgba(0,0,0,0.06);
}
.cover .inner { max-width: 920px; margin: 0 auto; }
.cover h1 { margin: 0 0 10px 0; font-size: 42px; letter-spacing: .3px; }
.cover .meta { opacity: .95; font-size: 16px; }

.toc-card {
  background: #f8fafc;
  border: 1px solid #e2e8f0;
  border-radius: 12px;
  padding: 18px 20px;
  margin: 20px 0 28px 0;
}
.toc-card h2 { margin: 0 0 8px 0; font-size: 18px; color: var(--muted); }
.toc-list { list-style: none; padding-left: 0; margin: 0; }
.toc-list li { margin: 4px 0; }
.toc-list li.lvl1 { font-weight: 700; margin-top: 8px; }
.toc-list li.lvl2 { margin-left: 16px; }
.toc-list li.lvl3 { margin-left: 32px; }
.toc-list a { color: var(--accent); text-decoration: none; }
.toc-list a:hover { text-decoration: underline; }

h1{ font-size: 28px; margin: 28px 0 10px; }
h2{ font-size: 22px; margin: 24px 0 8px; padding-bottom: 6px; border-bottom: 2px solid #e5e7eb; }
h3{ font-size: 18px; margin: 18px 0 6px; color: var(--muted); }

p { margin: 12px 0; }
ul, ol { margin: 8px 0 12px 24px; }
li { margin: 4px 0; }

hr { border: none; border-top: 1px dashed #cbd5e1; margin: 24px 0; }

blockquote {
  margin: 10px 0; padding: 10px 14px;
  background:#f1f5f9; color:#0f172a;
  border-left: 4px solid var(--accent);
  border-radius: 8px;
}

pre { background: var(--code-bg); color: var(--code-fg); padding: 12px 14px; border-radius: 10px; overflow:auto; }
code { background: rgba(2,6,23,.06); padding: 2px 6px; border-radius: 6px; }

.badge {
  display: inline-block; background: #eef2ff; color: #3730a3;
  padding: 2px 8px; border-radius: 999px; font-size: 12px; margin-left: 8px;
}

.footer-note {
  margin-top: 40px; font-size: 12px; color: var(--muted);
}
</style>
</head>
<body>
  <div class="cover">
    <div class="inner">
      <h1>Bont√°sinapl√≥ ‚Äì Haszn√°lati √∫tmutat√≥</h1>
      <div class="meta">Verzi√≥: 2025.08.13. <span class="badge">Nyomtathat√≥</span></div>
    </div>
  </div>

  <div class="container">
    <div class="toc-card">
      <h2>Tartalomjegyz√©k</h2>
      <ul class='toc-list'>
<li class="lvl1"><a href="#bontasinaplo-hasznalati-utmutato">Bont√°sinapl√≥ ‚Äì Haszn√°lati √∫tmutat√≥</a></li>
<li class="lvl2"><a href="#1-attekintes">1) √Åttekint√©s</a></li>
<li class="lvl2"><a href="#2-telepites-inditas">2) Telep√≠t√©s &amp; ind√≠t√°s</a></li>
<li class="lvl3"><a href="#2-1-elofeltetelek">2.1. El≈ëfelt√©telek</a></li>
<li class="lvl3"><a href="#2-2-fuggosegek-telepitese">2.2. F√ºgg≈ës√©gek telep√≠t√©se</a></li>
<li class="lvl3"><a href="#2-3-inditas">2.3. Ind√≠t√°s</a></li>
<li class="lvl2"><a href="#3-gyors-kezdes-napi-hasznalat">3) Gyors kezd√©s (napi haszn√°lat)</a></li>
<li class="lvl3"><a href="#3-1-uj-tetel-rogzitese-rogzites-menu">3.1. √öj t√©tel r√∂gz√≠t√©se (R√∂gz√≠t√©s men√º)</a></li>
<li class="lvl3"><a href="#3-2-reszek-rogzitese">3.2. R√©szek r√∂gz√≠t√©se</a></li>
<li class="lvl3"><a href="#3-3-tetel-lezarasa">3.3. T√©tel lez√°r√°sa</a></li>
<li class="lvl2"><a href="#4-csatolmanyok-kulon-menu">4) Csatolm√°nyok (k√ºl√∂n men√º)</a></li>
<li class="lvl2"><a href="#5-torzsadatok-kapcsolasok-erp">5) T√∂rzsadatok &amp; kapcsol√°sok (ERP)</a></li>
<li class="lvl2"><a href="#6-beallitasok">6) Be√°ll√≠t√°sok</a></li>
<li class="lvl3"><a href="#6-1-vir-kulso-json-endpoint">6.1. VIR (k√ºls≈ë JSON endpoint)</a></li>
<li class="lvl3"><a href="#6-2-postgresql-json-api-api-bontasi-naplo">6.2. PostgreSQL (JSON ‚Üí `api.api_bontasi_naplo`)</a></li>
<li class="lvl3"><a href="#6-3-merleg-rs232-usb">6.3. M√©rleg (RS232/USB)</a></li>
<li class="lvl3"><a href="#6-4-csatolmany-tarhely">6.4. Csatolm√°ny t√°rhely</a></li>
<li class="lvl2"><a href="#7-exportok">7) Exportok</a></li>
<li class="lvl2"><a href="#8-adatszerkezet-lokalis">8) Adatszerkezet (lok√°lis)</a></li>
<li class="lvl2"><a href="#9-tipikus-hibak-es-elharitas">9) Tipikus hib√°k √©s elh√°r√≠t√°s</a></li>
<li class="lvl3"><a href="#9-1-merleg-nem-olvashato">9.1. M√©rleg nem olvashat√≥</a></li>
<li class="lvl3"><a href="#9-2-too-many-postgresql-connections">9.2. ‚ÄûToo many PostgreSQL connections‚Äù</a></li>
<li class="lvl3"><a href="#9-3-dupla-adatok-a-pg-ben">9.3. Dupla adatok a PG-ben</a></li>
<li class="lvl3"><a href="#9-4-attributeerror-streamlit-experimental-rerun">9.4. ‚ÄûAttributeError: streamlit.experimental_rerun‚Äù</a></li>
<li class="lvl2"><a href="#10-legjobb-gyakorlatok">10) Legjobb gyakorlatok</a></li>
<li class="lvl2"><a href="#11-integracios-reszletek">11) Integr√°ci√≥s r√©szletek</a></li>
<li class="lvl3"><a href="#11-1-vir-http-kuldes">11.1. VIR HTTP-k√ºld√©s</a></li>
<li class="lvl3"><a href="#11-2-pg-outbox-api-api-bontasi-naplo">11.2. PG outbox ‚Üí `api.api_bontasi_naplo`</a></li>
<li class="lvl2"><a href="#12-karbantartas-uzemeltetes">12) Karbantart√°s / √ºzemeltet√©s</a></li>
</ul>
    </div>

    <h1 id="bontasinaplo-hasznalati-utmutato">Bont√°sinapl√≥ ‚Äì Haszn√°lati √∫tmutat√≥</h1>

<p><strong>Verzi√≥:</strong> 2025.08.13.</p>

<h2 id="1-attekintes">1) √Åttekint√©s</h2>
<p>A Bont√°sinapl√≥ egy <strong>√©rint≈ëbar√°t</strong> Streamlit-alap√∫ alkalmaz√°s, amelyben r√∂gz√≠thet≈ë:</p>
<ul>
<li>a be√©rkezett t√©tel (√°llat, lot/t√©tel adatok, √∂sszt√∂meg),</li>
<li>a bont√°si <strong>r√©szek</strong> √©s azok <strong>t√∂mege</strong> (ak√°r m√©rlegr≈ël, RS232/USB-n),</li>
<li><strong>hozam</strong> √©s <strong>k√ºl√∂nb√∂zet</strong> automatikus sz√°m√≠t√°sa,</li>
<li><strong>mell√©kletek</strong> (sz√°ll√≠t√≥lev√©l-fot√≥ stb.) kezel√©se (t√∂m√∂r√≠tve, b√©lyegk√©ppel),</li>
<li><strong>VIR</strong> JSON-k√ºld√©s (HMAC al√°√≠rva ‚Äì opcion√°lis),</li>
<li><strong>PostgreSQL</strong> fel√© JSON bek√ºld√©s <strong>outbox</strong> sorral √©s automatikus √∫jrapr√≥b√°lkoz√°ssal,</li>
<li><strong>ERP-kapcsol√°s</strong>: √°llat-r√©szek √∂sszek√∂t√©se az ERP cikkekkel (PG-b≈ël t√∂ltve),</li>
<li><strong>PDF</strong> √©s <strong>CSV</strong> export.</li>
</ul>

<p>Fel√ºlet men√ºpontjai fel√ºl:</p>
<ul>
<li><strong>R√∂gz√≠t√©s</strong> ‚Äì napi munka: t√©telek, r√©szek, hozam, lez√°r√°s.</li>
<li><strong>Csatolm√°nyok</strong> ‚Äì k√ºl√∂n t√°rhelyre mentett k√©pek/f√°jlok kezel√©se.</li>
<li><strong>T√∂rzsadatok &amp; kapcsol√°sok</strong> ‚Äì √°llatok √©s r√©szek karbantart√°sa, ERP-kapcsol√°s.</li>
<li><strong>Be√°ll√≠t√°sok</strong> ‚Äì PG, VIR, m√©rleg (RS232), csatolm√°ny-t√°rhely, outbox/pool admin.</li>
</ul>

<hr/>

<h2 id="2-telepites-inditas">2) Telep√≠t√©s &amp; ind√≠t√°s</h2>

<h3 id="2-1-elofeltetelek">2.1. El≈ëfelt√©telek</h3>
<ul>
<li>Python <strong>3.9+</strong> (aj√°nlott 3.10‚Äì3.12)</li>
<li>Helyi g√©pen kamera (opcion√°lis ‚Äì fot√≥z√°shoz) √©s USB‚ÄìRS232 adapter a m√©rleghez</li>
</ul>

<h3 id="2-2-fuggosegek-telepitese">2.2. F√ºgg≈ës√©gek telep√≠t√©se</h3>
<p>1) (Aj√°nlott) virtu√°lis k√∂rnyezet:</p>
<pre><code>
python -m venv .venv
source .venv/bin/activate   # Windows: .venv\Scripts\activate
</code></pre>
<p>2) Csomagok:</p>
<pre><code>
pip install -r requirements.txt
</code></pre>
<p>Ha m√©rleget haszn√°lsz: a <code>pyserial</code> is kell (a <code>requirements.txt</code>-ben benne van).</p>

<h3 id="2-3-inditas">2.3. Ind√≠t√°s</h3>
<pre><code>
streamlit run streamlit_app.py
</code></pre>
<p>A b√∂ng√©sz≈ëben megny√≠l√≥ c√≠men (pl. <code>http://localhost:8501</code>) el√©red az appot.</p>

<blockquote>**Megjegyz√©s:** macOS-en √©s Linuxon az RS232-hez a port-hozz√°f√©r√©shez enged√©ly kellhet (USB-soros driver, csoporttags√°g `dialout` stb.). Windows-on a COM portot (pl. COM3) fogod l√°tni.</blockquote>

<hr/>

<h2 id="3-gyors-kezdes-napi-hasznalat">3) Gyors kezd√©s (napi haszn√°lat)</h2>

<h3 id="3-1-uj-tetel-rogzitese-rogzites-menu">3.1. √öj t√©tel r√∂gz√≠t√©se (R√∂gz√≠t√©s men√º)</h3>
<p>1. Fels≈ë men√ºsorban l√©pj a <strong>R√∂gz√≠t√©s</strong> f√ºlre.</p>
<p>2. Bal oldali <strong>M≈±veletek</strong> s√°vban v√°laszd ki az <strong>√Ållatot</strong> (pl. Sert√©s).</p>
<p>3. <strong>√öj bont√°si t√©tel</strong> ≈±rlap:</p>
<p>- <strong>D√°tum</strong></p>
<p>- <strong>T√©tel/Lot azonos√≠t√≥</strong></p>
<p>- <strong>Besz√°ll√≠t√≥</strong>, <strong>Eredet/ENAR</strong>, <strong>Ellen≈ërizte</strong></p>
<p>- <strong>Be√©rkezett √∂sszt√∂meg (kg)</strong></p>
<p>- k√©zzel be√≠rhat√≥, vagy</p>
<p>- <strong>‚öñÔ∏è M√©rleg beolvas√°sa</strong> gombbal RS232/USB m√©rlegr≈ël.</p>
<p>- <strong>Megjegyz√©s</strong></p>
<p>4. <strong>T√©tel ment√©se</strong> ‚Üí a t√©telek t√°bl√°zat√°ban megjelenik.</p>

<blockquote>A m√©rleg gomb m≈±k√∂d√©s√©hez a **Be√°ll√≠t√°sok ‚Üí M√©rleg** r√©szen el≈ëzetesen √°ll√≠tsd be a portot √©s param√©tereket.</blockquote>

<h3 id="3-2-reszek-rogzitese">3.2. R√©szek r√∂gz√≠t√©se</h3>
<p>1. A t√©telek t√°bl√°j√°b√≥l v√°laszd ki az akt√≠v t√©tel <strong>ID-j√©t</strong>.</p>
<p>2. <strong>√ârint≈ë panel</strong>:</p>
<p>- fent v√°laszthatsz <strong>R√©szt</strong> (pl. Comb). Sz≈±r≈ëmez≈ë is van.</p>
<p>- <strong>T√∂meg (kg)</strong> megad√°s:</p>
<p>- <strong>sz√°mbillenty≈±zettel</strong>, vagy</p>
<p>- <strong>‚öñÔ∏è M√©rleg beolvas√°sa</strong> gombbal.</p>
<p>- opcion√°lis <strong>Megjegyz√©s</strong>.</p>
<p>- <strong>‚ûï Hozz√°ad√°s</strong> ‚Üí a r√©sz beker√ºl.</p>
<p>3. <strong>R√∂gz√≠tett r√©szek</strong>:</p>
<p>- <strong>√ñsszes√≠t√©s</strong>: r√©szenk√©nti √∂sszt√∂meg.</p>
<p>- <strong>R√©szletek</strong>: id≈ëb√©lyeggel list√°zva, soronk√©nt <strong>üóëÔ∏è</strong> t√∂rl√©s (csak <strong>nyitott</strong> t√©teln√©l).</p>
<p>4. <strong>Hozam √©s egyenleg</strong>:</p>
<p>- Be√©rkezett (kg), R√∂gz√≠tett r√©szek (kg), Hozam % = (sum r√©szek / be√©rkezett)*100, K√ºl√∂nb√∂zet (kg).</p>
<p>- <strong>‚ûï K√ºl√∂nb√∂zet felv√©tele</strong>: a marad√©kot egy kiv√°lasztott r√©szhez (pl. ‚ÄûCsont‚Äù) automatikusan r√∂gz√≠ti.</p>

<h3 id="3-3-tetel-lezarasa">3.3. T√©tel lez√°r√°sa</h3>
<ul>
<li><strong>T√©tel lez√°r√°sa √©s teljes adathalmaz k√ºld√©se</strong>:</li>
</ul>
<p>- jel√∂ld be: ‚ÄûMeger≈ës√≠tem‚Ä¶‚Äù</p>
<p>- <strong>üîí Bont√°s k√©sz / Lez√°r√°s</strong></p>
<ul>
<li>Lez√°r√°s ut√°n:</li>
</ul>
<p>- a t√©tel <strong>nem m√≥dos√≠that√≥</strong>, r√©szt/ csatolm√°nyt t√∂r√∂lni nem lehet,</p>
<p>- a <strong>PostgreSQL outbox</strong> sorba beker√ºl a <strong>teljes csomag</strong> (<code>batch_closed</code>), amit a h√°tt√©rk√ºld≈ë tov√°bb√≠t.</p>

<blockquote>Ugyanazon t√©tel **batch_closed** esem√©ny√©t a rendszer **deduplik√°lja** (nem k√ºldi k√©tszer).</blockquote>

<hr/>

<h2 id="4-csatolmanyok-kulon-menu">4) Csatolm√°nyok (k√ºl√∂n men√º)</h2>
<ul>
<li>V√°laszd ki fel√ºl a <strong>Csatolm√°nyok</strong> men√ºt.</li>
<li>T√©tel kiv√°laszt√°sa ut√°n:</li>
</ul>
<p>- el≈ën√©zet (b√©lyegk√©pek) + lista (ID, MIME, megjegyz√©s, √∫tvonal),</p>
<p>- <strong>üìé Mell√©klet ment√©se</strong>: kamera (<strong>Fot√≥ k√©sz√≠t√©se</strong>) vagy <strong>Felt√∂lt√©s</strong> (JPG/PNG/PDF),</p>
<p>- k√©pek <strong>t√∂m√∂r√≠tve</strong> t√°rol√≥dnak (JPEG, √°ll√≠that√≥ min≈ës√©g/m√©ret), √©s <strong>thumbnail</strong> is k√©sz√ºl,</p>
<p>- <strong>üóëÔ∏è t√∂rl√©s</strong> csak <strong>nyitott</strong> t√©teln√©l enged√©lyezett.</p>

<p><strong>T√°rhely</strong> √©s <strong>t√∂m√∂r√≠t√©s</strong> param√©terei a <strong>Be√°ll√≠t√°sok ‚Üí Csatolm√°nyok t√°rhely</strong> oldalon √°ll√≠that√≥k:</p>
<ul>
<li>alap k√∂nyvt√°r (pl. h√°l√≥zati megoszt√°s),</li>
<li>d√°tumos almapp√°k (YYYY/MM/<code>&lt;batch_id&gt;</code>),</li>
<li>max. k√©pm√©ret (px), JPEG min≈ës√©g.</li>
</ul>

<hr/>

<h2 id="5-torzsadatok-kapcsolasok-erp">5) T√∂rzsadatok &amp; kapcsol√°sok (ERP)</h2>
<p>Itt hozhatsz l√©tre/szerkeszthetsz:</p>
<ul>
<li><strong>√Ållatokat</strong> (pl. Sert√©s, Marha, √∫j: Macska) ‚Äì aktiv√°l√°s/inaktiv√°l√°s, √°tnevez√©s,</li>
<li><strong>R√©szeket</strong> √°llatonk√©nt ‚Äì felv√©tel, √°tnevez√©s, deaktiv√°l√°s,</li>
<li><strong>ERP-kapcsol√°st</strong>:</li>
</ul>
<p>1. √Ållat kiv√°laszt√°sa ‚Üí saj√°t r√©szek list√°ja,</p>
<p>2. <strong>ERP cikkek bet√∂lt√©se</strong> a PostgreSQL-b≈ël (lek√©rdez√©s: <code>SELECT * FROM alapadat.tetel WHERE ceg_id = 3</code>),</p>
<p>3. oszlopok (ID/n√©v/k√≥d) automatikus felismer√©se ut√°n <strong>kapcsold √∂ssze</strong> a r√©szeket ERP-cikkekkel.</p>

<blockquote>Ha egy r√©szhez van ERP-kapcsol√°s, a k√ºld√∂tt JSON-ban megjelenik **`tetel_id`/`erp_id`** (√©s opcion√°lisan ERP k√≥d/n√©v).</blockquote>

<hr/>

<h2 id="6-beallitasok">6) Be√°ll√≠t√°sok</h2>

<h3 id="6-1-vir-kulso-json-endpoint">6.1. VIR (k√ºls≈ë JSON endpoint)</h3>
<ul>
<li><strong>VIR endpoint URL</strong>: a c√©l API c√≠me</li>
<li><strong>API kulcs</strong> (opcion√°lis): <code>X-API-Key</code> fejl√©cben</li>
<li><strong>Al√°√≠r√≥ titok</strong> (opcion√°lis): <strong>HMAC-SHA256</strong> ‚Äì <code>X-Signature</code> fejl√©cben a JSON t√∂rzs hash-e</li>
<li><strong>Auto-k√ºld√©s ment√©skor</strong>: ha be van kapcsolva, <strong>r√©sz hozz√°ad√°sakor</strong> is megy <code>part_created</code> esem√©ny</li>
</ul>

<p><strong>Esem√©nyek:</strong></p>
<ul>
<li><code>part_created</code> (inkrement√°lis ‚Äì egy r√©sz)</li>
<li><code>batch_closed</code> (lez√°r√°skor a teljes csomag)</li>
</ul>

<h3 id="6-2-postgresql-json-api-api-bontasi-naplo">6.2. PostgreSQL (JSON ‚Üí `api.api_bontasi_naplo`)</h3>
<ul>
<li>A kapcsolat adatai <strong>Streamlit Secrets</strong>-b≈ël vagy <strong>k√∂rnyezeti v√°ltoz√≥b√≥l</strong> is j√∂hetnek (a jelsz√≥t nem mutatjuk a fel√ºleten).</li>
<li>Auto-k√ºld√©s (PG): ha be van kapcsolva, <strong>r√©sz ment√©skor</strong> is sorba √°ll√≠that√≥ (javasolt ink√°bb z√°r√°skor k√ºldeni a teljes csomagot).</li>
<li><strong>Sor ki√ºr√≠t√©se most (Flush)</strong> ‚Äì k√©zi k√ºld√©s ind√≠t√°s.</li>
<li><strong>Statisztika</strong> ‚Äì h√°ny √ºzenet v√°r, folyamatban, elk√ºldve.</li>
<li><strong>Admin / pool st√°tusz</strong> ‚Äì kapcsolat medence (pool) √°llapota, <strong>Ping</strong>, <strong>pool z√°r√°sa/√∫jranyit√°sa</strong> gombok.</li>
</ul>

<p><strong>Outbox m≈±k√∂d√©s:</strong></p>
<ul>
<li>Ha a PG <strong>nem el√©rhet≈ë</strong>, az √ºzenetek <strong>pending</strong> √°llapotban maradnak; a h√°tt√©rsz√°l <strong>exponenci√°lis visszav√°rakoz√°ssal</strong> √∫jrapr√≥b√°lkozik.</li>
<li>A <code>batch_closed</code> esem√©ny <strong>deduplik√°lt</strong> ‚Äì ugyanarra a t√©telre nem ker√ºl k√©t ugyanolyan z√°r√≥ √ºzenet sorba.</li>
</ul>

<h3 id="6-3-merleg-rs232-usb">6.3. M√©rleg (RS232/USB)</h3>
<ul>
<li><strong>Port</strong> kiv√°laszt√°sa list√°b√≥l vagy k√©zi megad√°s:</li>
</ul>
<p>- Windows: <code>COM3</code> stb.</p>
<p>- macOS: <code>/dev/cu.usbserial-...</code> vagy <code>/dev/tty.usbserial-...</code></p>
<p>- Linux: <code>/dev/ttyUSB0</code>, <code>/dev/ttyACM0</code>, stb.</p>
<ul>
<li>Param√©terek: <strong>baud</strong>, <strong>adatbit</strong>, <strong>parit√°s</strong>, <strong>stopbit</strong>, <strong>timeout</strong></li>
<li><strong>Kimeneti m√©rt√©kegys√©g</strong>: kg/g/lb/t (bels≈ë konverzi√≥)</li>
<li><strong>‚öñÔ∏è Teszt beolvas√°s</strong> gomb ‚Äì nyers sorok megjelen√≠thet≈ëk hibakeres√©shez.</li>
</ul>

<h3 id="6-4-csatolmany-tarhely">6.4. Csatolm√°ny t√°rhely</h3>
<ul>
<li>Alap k√∂nyvt√°r (pl. <code>\\NAS\megosztas\bontas</code>),</li>
<li>D√°tumos almapp√°k,</li>
<li>K√©pm√©ret √©s JPEG min≈ës√©g.</li>
</ul>

<hr/>

<h2 id="7-exportok">7) Exportok</h2>
<ul>
<li><strong>CSV</strong>:</li>
</ul>
<p>- teljes t√©telek lista,</p>
<p>- akt√≠v t√©tel r√©szei.</p>
<ul>
<li><strong>PDF jelent√©s</strong> (t√©tel szint≈±): fejl√©cadatok, r√∂gz√≠tett r√©szek, hozam/elt√©r√©s, els≈ë k√©p beillesztve (ha van).</li>
</ul>

<hr/>

<h2 id="8-adatszerkezet-lokalis">8) Adatszerkezet (lok√°lis)</h2>
<p>A program helyben egy <strong>SQLite</strong> adatb√°zist haszn√°l (<code>bontas.db</code>):</p>
<ul>
<li><code>batches</code>: t√©telfej (√°llat, d√°tum, lot, besz√°ll√≠t√≥, be√©rkezett t√∂meg, st√°tusz, z√°r√°s ideje)</li>
<li><code>parts</code>: r√©szek (t√©telhez, n√©v, t√∂meg, megjegyz√©s, l√©trehoz√°si id≈ë)</li>
<li><code>attachments</code>: csatolm√°nyok (√∫tvonal, MIME, thumbnail √∫tvonal)</li>
<li><code>settings</code>: be√°ll√≠t√°sok (kulcs‚Äì√©rt√©k)</li>
<li><code>pg_outbox</code>: PG-be k√ºldend≈ë √ºzenetek sora (payload, √°llapot, pr√≥b√°lkoz√°sok)</li>
<li><code>sync_log</code>: k√ºld√©si napl√≥ (VIR/PG)</li>
<li><code>animals</code>, <code>custom_parts</code>: √°llatok √©s hozz√°juk tartoz√≥ r√©szek</li>
<li><code>part_mappings</code>: ERP-kapcsol√°sok (√°llat + r√©sz ‚Üí ERP id/n√©v/k√≥d)</li>
</ul>

<p><strong>Ment√©s:</strong> rendszeresen k√©sz√≠ts biztons√°gi ment√©st a <code>bontas.db</code>-r≈ël √©s a csatolm√°ny-k√∂nyvt√°rr√≥l (alap√©rtelmez√©s: <code>docs/</code> vagy a megadott t√°rhely).</p>

<hr/>

<h2 id="9-tipikus-hibak-es-elharitas">9) Tipikus hib√°k √©s elh√°r√≠t√°s</h2>

<h3 id="9-1-merleg-nem-olvashato">9.1. M√©rleg nem olvashat√≥</h3>
<ul>
<li>Telep√≠tve van a <code>pyserial</code>? ‚Üí <code>pip install pyserial</code></li>
<li>A port helyes? (Windows: <code>COMx</code>, macOS: <code>/dev/cu.usbserial-...</code>)</li>
<li>Jogosults√°g:</li>
</ul>
<p>- macOS: a Terminal/IDE kapjon USB hozz√°f√©r√©st; pr√≥b√°ld ki adminnal.</p>
<p>- Linux: felhaszn√°l√≥ a <code>dialout</code> csoportban (<code>sudo usermod -a -G dialout $USER</code> + kijelentkez√©s).</p>
<ul>
<li>A m√©rleg k√ºld-e folyamatosan sort? Nyomj gombot a m√©rlegen (‚ÄûPrint‚Äù, ‚ÄûSend‚Äù), ha kell.</li>
</ul>

<h3 id="9-2-too-many-postgresql-connections">9.2. ‚ÄûToo many PostgreSQL connections‚Äù</h3>
<ul>
<li>N√©zd meg a <strong>Be√°ll√≠t√°sok ‚Üí Admin / pool</strong> r√©szt (pool m√©ret, checked-out).</li>
<li>Z√°rd le a f√∂l√∂s poolokat: <strong>√ñsszes pool lez√°r√°sa</strong>.</li>
<li>√úgyelj r√°, hogy <strong>ne fusson p√°rhuzamosan sok p√©ld√°ny</strong> ugyanazon DSN-nel.</li>
</ul>

<h3 id="9-3-dupla-adatok-a-pg-ben">9.3. Dupla adatok a PG-ben</h3>
<ul>
<li>A <code>batch_closed</code> deduplik√°lt.</li>
<li>Ha az <strong>ERP oldalon</strong> is kell deduplik√°ci√≥: szerveroldali <code>md5(adat)</code> egyedi index (√ºzemeltet√©sn√©l).</li>
</ul>

<h3 id="9-4-attributeerror-streamlit-experimental-rerun">9.4. ‚ÄûAttributeError: streamlit.experimental_rerun‚Äù</h3>
<ul>
<li>√öj Streamlit verzi√≥kban haszn√°ld a <code>st.rerun()</code>-t.</li>
</ul>

<hr/>

<h2 id="10-legjobb-gyakorlatok">10) Legjobb gyakorlatok</h2>

<ul>
<li><strong>Lez√°r√°s el≈ëtt</strong> ellen≈ërizd: r√©szek √∂sszege ‚âà be√©rkezett t√∂meg (k√ºl√∂nb√∂zet r√∂gz√≠thet≈ë automatikusan).</li>
<li><strong>Csak nyitott t√©telt</strong> m√≥dos√≠ts/t√∂r√∂lj. Lez√°r√°s ut√°n a t√©tel <strong>arch√≠v</strong>.</li>
<li><strong>√ârint≈ën</strong>: nagy√≠tott vez√©rl≈ëk, sz√°mbillenty≈±zet haszn√°lata.</li>
<li><strong>T√°rhely</strong>: csatolm√°nyok t√∂m√∂r√≠t√©se + b√©lyegk√©p; t√°rhely k√ºl√∂n diszk/NAS.</li>
<li><strong>Biztons√°g</strong>: PG jelsz√≥ <strong>Secrets/env</strong> ‚Äì ne a UI-ba √≠rd.</li>
<li><strong>Ment√©s</strong>: <code>bontas.db</code> + csatolm√°ny-k√∂nyvt√°r rendszeres backup.</li>
</ul>

<hr/>

<h2 id="11-integracios-reszletek">11) Integr√°ci√≥s r√©szletek</h2>

<h3 id="11-1-vir-http-kuldes">11.1. VIR HTTP-k√ºld√©s</h3>
<ul>
<li><code>POST</code> JSON, <code>Content-Type: application/json</code></li>
<li>Fejl√©cek (opcion√°lis): <code>X-API-Key</code>, <code>X-Signature</code> (HMAC-SHA256)</li>
<li>Esem√©nyek: <code>part_created</code>, <code>batch_closed</code></li>
</ul>

<p><strong>P√©lda ‚Äì <code>batch_closed</code> t√∂rzs (r√©szlet):</strong></p>
<pre><code class="lang-json">
{
  &quot;source&quot;: {&quot;system&quot;: &quot;Bontasinaplo&quot;},
  &quot;event&quot;: &quot;batch_closed&quot;,
  &quot;batch&quot;: {&quot;id&quot;: 123, &quot;animal&quot;: &quot;Sert√©s&quot;, &quot;gross_weight_kg&quot;: 300.0},
  &quot;parts&quot;: [{&quot;name&quot;: &quot;Comb&quot;, &quot;weight_kg&quot;: 120.5}]
}
</code></pre>

<h3 id="11-2-pg-outbox-api-api-bontasi-naplo">11.2. PG outbox ‚Üí `api.api_bontasi_naplo`</h3>
<ul>
<li>Fogad√≥ t√°bla (szerver):</li>
</ul>
<p><code>CREATE TABLE IF NOT EXISTS api.api_bontasi_naplo(id BIGSERIAL PRIMARY KEY, adat TEXT);</code></p>
<ul>
<li>Kliens: outbox sor, h√°tt√©rk√ºld≈ë, visszav√°rakoz√°s el√©rhetetlens√©g eset√©n.</li>
</ul>

<hr/>

<h2 id="12-karbantartas-uzemeltetes">12) Karbantart√°s / √ºzemeltet√©s</h2>

<ul>
<li><strong>Napl√≥k</strong>: k√ºld√©si napl√≥ (UI), ig√©ny eset√©n f√°jl-log.</li>
<li><strong>Friss√≠t√©s</strong>: <code>pip install -r requirements.txt</code> futtat√°sa √∫j verzi√≥ ut√°n.</li>
<li><strong>Automatikus indul√°s</strong>: Docker Compose vagy <code>systemd</code>.</li>
<li><strong>Teljes√≠tm√©ny</strong>: PG pool finomhangol√°sa, ‚ÄûPool st√°tusz‚Äù figyel√©se.</li>
</ul>

    <div class="footer-note">
      K√©sz√ºlt: 2025.08.13. ‚Ä¢ Bont√°sinapl√≥ ‚Äî bels≈ë haszn√°latra.
    </div>
  </div>
</body>
</html>
